<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="../Form/spanvalidaciones.js"></script>


    <title>Formulario Atrinium</title>

</head>

<body class="back">
    <div class="container mt-5">

        <form action="" method="post" id="atrinium" name="atrinium" onsubmit="spanvalidaciones()">

            <div class="row">

                <!-- GRUPO PAÍS -->
                <div class="col-md-4 atrinium__group">

                    <label for="country" class="atrinium__label">PAÍS</label>
                    <select class="custom-select atrinium__group-select" id="country" name="country">
                        <option selected>Selección</option>
                        <option value="1">España</option>
                        <option value="2">Bosnia</option>
                        <option value="3">Marruecos</option>
                    </select>
                    <span id="spancountry" class="atrinium__error" hidden> Debe elegir al menos un país.</span>

                </div>
            </div>

            <div class="row">

                <!-- GRUPO TIPO DE PERSONA -->
                <div class="col-sm-4 atrinium__group my-2">

                    <label for="person" class="atrinium__label">TIPO DE PERSONA</label>
                    <select class="custom-select atrinium__group-select" id="person" name="person">
                        <option selected>Selección</option>
                        <option value="1">Física</option>
                        <option value="2">Jurídica</option>
                    </select>
                    <span class="atrinium__error" id="spanperson" hidden> Debe elegir un tipo de persona</span>

                </div>

                <!-- GRUPO NOMBRE+APELLIDO -->
                <div class="col-sm atrinium__group my-2" id="show" hidden>

                    <!-- GRUPO NOMBRE -->
                    <div class="atrinium__group col-sm" id="nameform">
                        <label for="name" class="atrinium__label">NOMBRE</label>
                        <input class="form-control atrinium__group-input" id="name" name="name" placeholder="Sanda"
                            maxlength="25">
                        <span class="atrinium_error" id="spanname" hidden> Debe introducir un nombre.</span>
                    </div>

                    <!-- GRUPO APELLIDO -->
                    <div class="atrinium__group col-sm mb-3" id="lastname">
                        <label for="lastname" class="atrinium__label">APELLIDOS</label>
                        <input class="form-control atrinium__group-input" id="lastname-input" name="lastname"
                            placeholder="Spahic" maxlength="30">
                        <span class="atrinium__error" id="spanlastname-input" hidden> Debe introducir un
                            apellido.</span>
                    </div>
                </div>

                <!-- GRUPO COMPAÑÍA -->
                <div class="atrinium__group col-sm-8 my-2" id="companyform" hidden>
                    <label for="company" class="atrinium__label">NOMBRE DE EMPRESA</label>
                    <input class="form-control atrinium__group-input" id="company" name="company"
                        placeholder="SA Brtonigla" maxlength="40">
                    <span class="atrinium__error" id="spancompany" hidden> Debe introducir un nombre de empresa.</span>
                </div>
            </div>

            <div class="border rounded my-2">

                <!-- GRUPO CONTENEDOR DIRECCIÓN -->
                <div class="container my-2">
                    <div class="row">

                        <!-- GRUPO TIPO DE CALLE -->
                        <div class="atrinium__group col-sm-3">
                            <label for="street" class="atrinium__label">TIPO DE VÍA</label>
                            <select class="custom-select atrinium__group-select" id="street" name="street">
                                <option selected>Selección</option>
                                <option value="1">Alameda</option>
                                <option value="2">Avenida</option>
                                <option value="3">Bulevar</option>
                                <option value="4">Calle</option>
                                <option value="5">Camino</option>
                            </select>
                            <span class="atrinium__error" id="spanstreet" hidden> Debe elegir un tipo de vía.</span>
                        </div>

                        <!-- GRUPO NOMBRE CALLE -->
                        <div class="atrinium__group col-sm-9">
                            <label for="namestreet" class="atrinium__label">NOMBRE DE VÍA</label>
                            <input class="form-control atrinium__group-input" id="namestreet" name="namestreet"
                                placeholder="">
                            <span class="atrinium__error" id="spannamestreet" hidden> Debe elegir un nombre de
                                vía.</span>
                        </div>
                    </div>

                    <div class="row">

                        <!-- GRUPO Nº CALLE -->
                        <div class="atrinium__group col-sm-1">
                            <label for="numberstreet" class="atrinium__label">Nº</label>
                            <input class="form-control atrinium__group-input" id="numberstreet" name="numberstreet"
                                placeholder="" maxlength="3">
                        </div>

                        <!-- GRUPO ESCALERA -->
                        <div class="atrinium__group col-sm-1">
                            <label for="stairstreet" class="atrinium__label">ESC</label>
                            <input class="form-control atrinium__group-input" id="stairstreet" name="stairstreet"
                                placeholder="" maxlength="1">
                            <span class="atrinium__error" hidden> Debe asignar una escalera del portal.</span>
                        </div>

                        <!-- GRUPO PISO -->
                        <div class="atrinium__group col-sm-1">
                            <label for="floorstreet" class="atrinium__label">PISO</label>
                            <input class="form-control atrinium__group-input" id="floorstreet" name="floorstreet"
                                placeholder="" maxlength="2">
                            <span class="atrinium__error" hidden> Debe asignar un piso de vivienda.</span>
                        </div>

                        <!-- GRUPO LETRA -->
                        <div class="atrinium__group col-sm-1">
                            <label for="letterstreet" class="atrinium__label">LETRA</label>
                            <input class="form-control atrinium__group-input" id="letterstreet" name="letterstreet"
                                placeholder="" maxlength="1">
                            <span class="atrinium__error" hidden> Debe asignar una letra de vivienda.</span>
                        </div>

                        <!-- GRUPO LOCALIDAD -->
                        <div class="atrinium__group col-sm-3 offset-sm-3">
                            <label for="city" class="atrinium__label">LOCALIDAD</label>
                            <input class="form-control atrinium__group-input" id="city" name="city" placeholder=""
                                maxlength="25">

                        </div>

                        <!-- GRUPO CP -->
                        <div class="atrinium__group col-sm-2">
                            <label for="cp" class="atrinium__label">CP</label>
                            <input class="form-control atrinium__group-input" id="cp" name="cp" placeholder=""
                                maxlength="5">

                        </div>
                        <span class="atrinium__error" id="spannumberstreet" hidden> Debe asignar un número de
                            vía.</span>
                        <div class="w-100">
                            <span class="atrinium__error" id="spancity" hidden> Debe introducir una localidad.</span>
                        </div>
                        <div class="w-100">
                            <span class="atrinium__error" id="spancp" hidden> Debe introducir un CP.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row my-2">

                <!-- GRUPO TIPO DE DOCUMENTO -->
                <div class="atrinium__group col-sm-4">
                    <label for="typedoc" class="atrinium__label">DOCUMENTO</label>
                    <select class="custom-select atrinium__group-select" id="typedoc" name="typedoc">
                        <option value="0">Selección</option>
                        <option value="1">DNI</option>
                        <option value="2">NIE</option>
                        <option value="3">Pasaporte</option>
                        <option value="4">NIF</option>
                    </select>
                    <span class="atrinium__error" id="spantypedoc" hidden> Debe elegir un tipo de documento.</span>
                </div>

                <!-- GRUPO DNI -->
                <div class="atrinium__group col-sm-4" id="dni" hidden>  
                    <label for="dni-first" class="label__dni atrinium__label">DNI</label>
                    <div class="form-inline row">
                        <input type="text" class="form-control col-sm-5 dni-first atrinium__group-input mb-2"
                            id="dni-first" name="dni-first" style="margin-right: 10px; margin-left: 10px;"
                            placeholder="" maxlength="9">
                    </div>
                    <span class="atrinium__error" hidden> Debe elegir introducir un DNI válido.</span>
                </div>

                <!-- GRUPO NIE -->
                <div class="atrinium__group col-sm-4" id="nie" hidden>
                    <label for="nie-first" class="label__nie atrinium__label">NIE</label>
                    <div class="form-inline row">
                        <input type="text" class="form-control col-sm-5 nie-first atrinium__group-input mb-2"
                            style="margin-right: 10px; margin-left: 10px;" name="nie-first" id="nie-first"
                            placeholder="" maxlength="9">
                    </div>
                    <span class="atrinium__error" hidden> Debe elegir introducir un NIE válido.</span>
                    <span>Introduzca un "0" en vez de la letra inicial.</span>
                </div>

                <!-- GRUPO PASAPORTE -->
                <div class="atrinium__group col-sm-4" id="passport" hidden>
                    <label for="passport-input" class="label__passport atrinium__label">Nº PASAPORTE</label>
                    <div class="form-inline row">
                        <input type="text" class="form-control col-sm-6 passport atrinium__group-input mb-2"
                            id="passport-input" name="passport-input" style="margin-left: 10px;" placeholder=""
                            maxlength="10">
                        <span id="spanpassport-input" class="atrinium__error" hidden> Debe elegir introducir un
                            Pasaporte.</span>
                    </div>
                </div>

                <!-- GRUPO NIF -->
                <div class="atrinium__group col-sm-4" id="nif" hidden>
                    <label for="nif-first" class="atrinium__label">NIF</label>
                    <div class="form-inline row">
                        <input type="text" class="form-control col-sm-5 nif-letter atrinium__group-input mb-2"
                            id="nif-first" name="nif-first" style="margin-right: 10px; margin-left: 10px;"
                            placeholder="" maxlength="9">
                    </div>
                    <span class="atrinium__error" hidden> Debe elegir introducir un NIF válido.</span>
                </div>

            </div>

            <button type="submit" class="btn btn-primary my-2">Enviar</button>
            <button type="button" class="btn btn-primary" onclick="borrardatos()">Borrar datos</button>
        </form>
    </div>








    <script>
        const personfocused = document.atrinium.person; //acceso al select "tipo de persona"
        const countrysel = document.atrinium.country; //acceso al select de país
        const dnisel = document.atrinium.typedoc; // acceso al select "tipo de documento"
        const formulario = document.getElementById("atrinium"); // acceso al formulario
        const dni = document.getElementById("dni");
        const nie = document.getElementById("nie");
        const pas = document.getElementById("passport");
        const nif = document.getElementById("nif");
        const a = dnisel[1].style.display;
        const b = dnisel[2].style.display;
        const c = dnisel[3].style.display;
        const d = dnisel[4].style.display;
        const opc = document.getElementById("show"); // input nombre+appelido
        const opc2 = document.getElementById("companyform"); // input empresa

        personfocused.addEventListener("change", function () { // evento cambio tipo de persona

            if (personfocused.value == 1) { // caso persona física
                opc.removeAttribute('hidden'); // mostramos input nombre+apellido
                opc2.setAttribute('hidden', false); // ocultamos input compañía

                if (dnisel.value == 4) {
                    nif.setAttribute('hidden', false);
                    dnisel.value = 0;
                }

                if (countrysel.value == 1) { // Si es de España
                    dnisel[1].style.display = a; // Muestra solo DNI
                    dnisel[4].style.display = 'none';

                } else if (countrysel.value == 2 || countrysel.value == 3) { // Si no es España
                    dnisel[1].style.display = 'none';
                    dnisel[2].style.display = b; // Muestra NIE y Pasaporte
                    dnisel[3].style.display = c;
                    dnisel[4].style.display = 'none';
                } else if ((countrysel.value != 1) && (countrysel.value != 2) && (countrysel.value != 3)) {
                    // Si no hay un país seleccionado
                    dnisel[1].style.display = a; // Muestra todos los posibles documentos menos el NIF
                    dnisel[2].style.display = b;
                    dnisel[3].style.display = c;
                    dnisel[4].style.display = 'none';
                }

            } else
                if (personfocused.value == 2) { // caso persona jurídica
                    opc2.removeAttribute('hidden'); // se muestra input compañía
                    opc.setAttribute('hidden', false); // ocultamos input nombre+apellido

                    if (dnisel.value != 4) {
                        dni.setAttribute('hidden', false);
                        nie.setAttribute('hidden', false);
                        pas.setAttribute('hidden', false);
                        dnisel.value = 0;
                    }


                    dnisel[1].style.display = 'none';
                    dnisel[2].style.display = 'none';
                    dnisel[3].style.display = 'none';
                    dnisel[4].style.display = d; // mostramos solo tipo de doc "NIF"


                } else
                    if (personfocused.value != 1 || personfocused != 2) { // sin elegir tipo de persona
                        opc2.setAttribute('hidden', false); // ocultamos los input
                        opc.setAttribute('hidden', false);
                        if (countrysel.value == 1) {
                            dnisel[1].style.display = a; // mostramos el tipo de doc "DNI"
                            dnisel[2].style.display = 'none';
                            dnisel[3].style.display = 'none';
                            dnisel[4].style.display = d; // mostramos el tipo de doc "NIF"
                        } else if (countrysel.value == 2 || countrysel.value == 3) {
                            dnisel[1].style.display = 'none';
                            dnisel[2].style.display = b; // mostramos solo tipo de doc "NIE"
                            dnisel[3].style.display = c; // mostramos el tipo de doc "Pasaporte"
                            dnisel[4].style.display = d; // mostramos el tipo de doc "NIF"
                        } else if (countrysel.value != 1 || countrysel.value != 2 || countrysel.value != 3) {
                            dnisel[1].style.display = a; // mostramos todos los tipos de doc
                            dnisel[2].style.display = b;
                            dnisel[3].style.display = c;
                            dnisel[4].style.display = d;
                        }
                    }
        })

        countrysel.addEventListener("change", function () { // Evento cambio de país
            if (countrysel.value == 1) { // País = España
                dnisel[2].style.display = "none"; // no se muestra NIE y Pasaporte en selector
                dnisel[3].style.display = "none";
                dnisel[1].style.display = a;
                dnisel[4].style.display = b;
                pas.setAttribute('hidden', false); // En caso de que estuviera el input mostrado se oculta
                nie.setAttribute('hidden', false);
                if (personfocused.value == 2) { // Caso Persona jurídica
                    dnisel[4].style.display = d; // Mostramos solo NIF
                    dnisel[1].style.display = 'none';
                    dnisel[2].style.display = 'none';
                    dnisel[3].style.display = 'none';
                } else if (personfocused.value == 1) { // Caso persona física
                    dnisel[4].style.display = 'none';
                    dnisel[1].style.display = a; // Mostramos solo DNI
                    dnisel[2].style.display = 'none';
                    dnisel[3].style.display = 'none';
                }
            } else
                if (countrysel.value == 2 || countrysel.value == 3) { // País no España
                    dnisel[1].style.display = 'none';
                    dnisel[2].style.display = b;
                    dnisel[3].style.display = c;
                    dnisel[4].style.display = d;

                    if (personfocused.value == 2) { // Sí está seleccionada Persona jurídica
                        dnisel[4].style.display = d;
                        dnisel[1].style.display = 'none';
                        dnisel[2].style.display = 'none';
                        dnisel[3].style.display = 'none';
                    } else if (personfocused.value == 1) { // Si está seleccionada Persona física
                        dnisel[2].style.display = b;
                        dnisel[3].style.display = c;
                        dnisel[4].style.display = 'none';
                        dnisel[1].style.display = 'none';
                        dni.setAttribute('hidden', false);
                    }
                } else
                    if (countrysel.value != 1 || countrysel.value != 2 || countrysel.value != 3) { // Sin país seleccionado
                        if (personfocused.value == 1) {
                            dnisel[2].style.display = b;
                            dnisel[3].style.display = c;
                            dnisel[1].style.display = a;
                            dnisel[4].style.display = 'none';
                        } else if (personfocused.value == 2) {
                            dnisel[2].style.display = 'none';
                            dnisel[3].style.display = 'none';
                            dnisel[1].style.display = 'none';
                            dnisel[4].style.display = d;
                        }
                    }
        })

        dnisel.addEventListener("change", function () { // evento para mostrar input de tipo de documento

            if (dnisel.value == 1) { // Si seleccionamos DNI, mostramos el input para DNI
                dni.removeAttribute('hidden');
                nie.setAttribute('hidden', false);
                pas.setAttribute('hidden', false);
                nif.setAttribute('hidden', false);
            } else if (dnisel.value == 2) { // Si seleccionamos NIE, mostramos el input para NIE
                nie.removeAttribute('hidden');
                dni.setAttribute('hidden', false);
                pas.setAttribute('hidden', false);
                nif.setAttribute('hidden', false);
            } else if (dnisel.value == 3) { // Si seleccionamos Pasaporte, mostramos el input para Pasaporte
                pas.removeAttribute('hidden');
                dni.setAttribute('hidden', false);
                nie.setAttribute('hidden', false);
                nif.setAttribute('hidden', false);
            } else if (dnisel.value == 4) { // Si seleccionamos NIF, mostramos el input para NIF
                nif.removeAttribute('hidden');
                dni.setAttribute('hidden', false);
                nie.setAttribute('hidden', false);
                pas.setAttribute('hidden', false);
            } else if (dnisel.value == 0) { // 
                dni.setAttribute('hidden', false);
                nie.setAttribute('hidden', false);
                pas.setAttribute('hidden', false);
                nif.setAttribute('hidden', false);
            }
        })

        // FUNCIÓN LIMPIAR FORMULARIO
        function borrardatos() {
            const spans = document.querySelectorAll('#atrinium span');

            formulario.reset();
            dni.setAttribute('hidden', false);
            nie.setAttribute('hidden', false);
            pas.setAttribute('hidden', false);
            nif.setAttribute('hidden', false);
            opc.setAttribute('hidden', false);
            opc2.setAttribute('hidden', false);
            dnisel[1].style.display = a;
            dnisel[2].style.display = b;
            dnisel[3].style.display = c;
            dnisel[4].style.display = d;

            spans.forEach(function (x) { x.setAttribute('hidden', false) });

        }


        // VALIDAMOS DNI
        var dnif = document.getElementById("dni-first");

        dnif.addEventListener("blur",

            function (e) {
                var numero
                var letr
                var letra
                var expresion_regular_dni

                expresion_regular_dni = /^\d{8}[a-zA-Z]$/;

                if (expresion_regular_dni.test(e.target.value) == true) {
                    numero = e.target.value.substr(0, e.target.value.length - 1);
                    letr = e.target.value.substr(e.target.value.length - 1, 1);
                    numero = numero % 23;
                    letra = 'TRWAGMYFPDXBNJZSQVHLCKET';
                    letra = letra.substring(numero, numero + 1);
                    if (letra != letr.toUpperCase()) {
                        alert('DNI erroneo, la letra del NIF no se corresponde');
                        dnif.focus();
                    } else {
                        alert('DNI correcto');
                    }
                } else {
                    alert('DNI erroneo, formato no válido');
                }

            })


        // VALIDAMOS NIE
        var nief = document.getElementById("nie-first");

        nief.addEventListener("blur",

            function (e) {
                var numero
                var letr
                var letra
                var expresion_regular_dni

                expresion_regular_dni = /^\d{8}[a-zA-Z]$/;

                if (expresion_regular_dni.test(e.target.value) == true) {
                    numero = e.target.value.substr(0, e.target.value.length - 1);
                    letr = e.target.value.substr(e.target.value.length - 1, 1);
                    numero = numero % 23;
                    letra = 'TRWAGMYFPDXBNJZSQVHLCKET';
                    letra = letra.substring(numero, numero + 1);
                    if (letra != letr.toUpperCase()) {
                        alert('NIE erroneo, la letra del NIF no se corresponde');
                        dnif.focus();
                    } else {
                        alert('NIE correcto');
                    }
                } else {
                    alert('NIE erroneo, formato no válido');
                }

            })


        // VALIDAMOS NIF
        var niff = document.getElementById("nif-first");

        niff.addEventListener("blur",

            function (e) {
                let dni = e.target.value.substring(0, e.target.value.length - 1);
                let letr = e.target.value.charAt(e.target.value.length - 1);
                if (!isNaN(letr)) {
                    alert('Falta la letra');
                    return false;
                } else {
                    cadena = "TRWAGMYFPDXBNJZSQVHLCKET";
                    posicion = dni % 23;
                    letra = cadena.substring(posicion, posicion + 1);
                    if (letra != letr.toUpperCase()) {
                        alert("Nif no válido");
                        return false;
                    }
                }
                alert("Nif válido")
                return true;
            })

            // VALIDAMOS INPUT Nº PISO
            const nmbrstreet = document.getElementById("numberstreet");

            nmbrstreet.addEventListener("keyup", function(e){
                expresion = /^([0-9])*$/;

                if (expresion.test(e.target.value) == false){
                    alert("Este campo sólo admite números")
                    e.target.value = "";
                }
            })

            // VALIDAMOS INPUT PISO
            const pisostreet = document.getElementById("floorstreet");

            pisostreet.addEventListener("keyup", function(e){
                expresion = /^([0-9])*$/;

                if (expresion.test(e.target.value) == false){
                    alert("Este campo sólo admite números")
                    e.target.value = "";
                }
            })

            // VALIDAMOS INPUT CP
            const codp = document.getElementById("cp");

            codp.addEventListener("keyup", function(e){
                expresion = /^([0-9])*$/;

                if (expresion.test(e.target.value) == false){
                    alert("Este campo sólo admite números")
                    e.target.value = "";
                }
            })


            // VALIDAMOS INPUT LOCALIDAD
            const city = document.getElementById("city");

            city.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\s\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca letras y/o espacios")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            // VALIDAMOS INPUT NOMBRE CALLE
            const names = document.getElementById("namestreet");

            names.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\s\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca letras y/o espacios")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            // VALIDAMOS INPUT NOMBRE
            const name = document.getElementById("name");

            name.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\s\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca letras y/o espacios")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            // VALIDAMOS INPUT APELLIDOS
            const lastname = document.getElementById("lastname-input");

            lastname.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\s\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca letras y/o espacios")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            // VALIDAMOS INPUT NOMBRE DE EMPRESA
            const company = document.getElementById("company");

            company.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\s\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca letras y/o espacios")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            // VALIDAMOS INPUT LETRA
            const letter = document.getElementById("letterstreet");

            letter.addEventListener("keyup", function(e){
                expresion = /^[A-Za-z\t]+$/g;

                if (expresion.test(e.target.value) == false){
                    alert("Introduzca su letra")
                    e.target.value = e.target.value.substring(0, e.target.value.length - 1);
                }
                
            })

            

    </script>

</body>

</html>